Below we source the file of functions used to clean the data as well as any required packages.

```{r}
source("00_requirements.R")
source("01_funct_dataCleaning.R")
```

Load data

```{r}
FemaleLabor <- data.frame(read.csv("00_LaborForceData.csv"))
EducationExp <- data.frame(read.csv("00_GovEducationExpense.csv"))
BirthRate <- data.frame(read.csv("00_BirthRate.csv"))
FertilityRate <- data.frame(read.csv("00_FertilityRate.csv"))
ParentalLeave <- data.frame(read.csv("00_ParentalLeave.csv"))
TertiaryEnroll <- data.frame(read.csv("00_TertiaryEnrollmentRate.csv"))
```

We'll remove any unnecessary variables from the datasets then apply the functions defined above to each dataset.

```{r}
keep_col <- c("REF_AREA", "REF_AREA_LABEL", "TIME_PERIOD", "OBS_VALUE")

edu_clean <- EducationExp[,keep_col]
flabor_clean <- FemaleLabor[,keep_col]
brate_clean <- BirthRate[,keep_col]
fert_clean <- FertilityRate[,keep_col]
leave_clean <- ParentalLeave[,-c(1,2)]
enroll_clean <- TertiaryEnroll[,-c(1,2)]
```

```{r}
df_list <- list(edu_clean, flabor_clean, brate_clean, fert_clean, leave_clean, enroll_clean)

#check for missing values
for (d in df_list) {
  print(sum(is.na(d)))
}
```
Parental leave and Tertiary Enrollment are structured a bit differently from the other datasets. We need to separate male and female values and consider what we want to include in our model.

```{r}
#separating male and female values into their own columns
leave_sep <- leave_clean %>%
  pivot_wider(names_from = Disaggregation, values_from = Value, names_prefix = "days_")

enroll_sep <- enroll_clean %>%
  pivot_wider(names_from = Disaggregation, values_from = Value, names_prefix = "enrolled_")
```

We want to combine all of our data into one dataframe. However, some of the column names are not very descriptive so we must change the column names first.

```{r}
colnames(edu_clean)[colnames(edu_clean) == "OBS_VALUE"] <- "edu_exp"
colnames(flabor_clean)[colnames(flabor_clean) == "OBS_VALUE"] <- "female_labor_rate"
colnames(brate_clean)[colnames(brate_clean) == "OBS_VALUE"] <- "birth_rate"
colnames(fert_clean)[colnames(fert_clean) == "OBS_VALUE"] <- "fertility_rate"
```

Now we can merge all of our datasets into one dataframe

```{r}
df <- edu_clean %>%
  left_join(flabor_clean, by = c("REF_AREA", "REF_AREA_LABEL", "TIME_PERIOD")) %>%
  left_join(brate_clean, by = c("REF_AREA", "REF_AREA_LABEL", "TIME_PERIOD")) %>%
  left_join(fert_clean, by = c("REF_AREA", "REF_AREA_LABEL", "TIME_PERIOD")) %>%
  left_join(leave_sep, by = c("REF_AREA" = "Country.Code", "REF_AREA_LABEL" = "Country.Name", "TIME_PERIOD" = "Year")) %>%
  left_join(enroll_sep, by = c("REF_AREA" = "Country.Code", "REF_AREA_LABEL" = "Country.Name", "TIME_PERIOD" = "Year"))

colnames(df)[colnames(df) == "REF_AREA"] <- "country_code"
colnames(df)[colnames(df) == "REF_AREA_LABEL"] <- "country"
colnames(df)[colnames(df) == "TIME_PERIOD"] <- "year"
```


```{r}
sum(is.na(df))
colSums(is.na(df)) / nrow(df)

colSums(!is.na(df))
```
Certain columns have a large proportion of missing values which can be worrying when training models. However, these columns still have a large amount of observations despite the proportion of missing values. Since we plan on running a regression on our data, the high proportion of missing data should not have too large of an effect on our model so long as we have a large enough sample size. We can also omit different variables based on missingness and test the accuracy of different regression models. 

Our preliminary regression would most likely look something like:

$$
FemaleLabor_i = \beta_0 + \beta_1 EducationExpenditure + \beta_2 BirthRate + \beta_3 FertilityRate + \\ \beta_4 ParentalLeave + \beta_5 TertiaryEnrollment + \varepsilon_i
$$
We can explore other options within our model as we explore the relationships between different variables. Introducing exponential variables, interaction terms, time-fixed effects, applying log transformations, or even removing some variables may help improve the accuracy of our model.

We can start making preliminary visualizations for each variable.

#Government Expenditure on Education (% of GDP)
```{r}
summary(df$edu_exp)
hist(df$edu_exp, breaks = 75)
```

#Birth Rate (per 1000 people)
```{r}
summary(df$birth_rate)
hist(df$birth_rate, breaks = 50)
```
#Fertility Rate (births per woman)
```{r}
summary(df$fertility_rate)
hist(df$fertility_rate, breaks = 50)
```
#Length of paid parental leave (calendar days)
```{r}
#mother
summary(df$days_female)
#father
summary(df$days_male)
hist(df$days_female, breaks = 50)
hist(df$days_male, breaks = 50)
```
#School enrollment, tertiary (% gross)
```{r}
#Female
summary(df$enrolled_female)
#Male
summary(df$enrolled_male)
#Total
summary(df$enrolled_total)
hist(df$enrolled_male, breaks = 50)
hist(df$enrolled_female, breaks = 50)
hist(df$enrolled_total, breaks = 50)
```

#Female Labor Participation Rate (% of female population age 15+)
```{r}
summary(df$female_labor_rate)
hist(df$female_labor_rate, breaks = 50)
```
#Correlation Matrix





